<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Looking at Regex in Rust - Bas-Man's Musings</title><meta name=description content="If you have been following this series, you might know that I am playing with SPF records. I have turned my eye to a and mx mechanisms. As I started looking at the a mechanism. I noticed that my current approach using the standard string functions would probably be fairly difficult to implement. So I started to think about using the Regex crate. So this will be a look at how that went."><meta name=author content="Bas-Man"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Bas-Man\u0027s Musings","url":"https:\/\/bas-man.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/bas-man.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/bas-man.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/bas-man.github.io\/post\/rust\/rust-looking-at-regex\/","name":"Looking at regex in rust"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Bas-Man"},"headline":"Looking at Regex in Rust","description":"If you have been following this series, you might know that I am playing with SPF records. I have turned my eye to a and mx mechanisms. As I started looking at the a mechanism. I noticed that my current approach using the standard string functions would probably be fairly difficult to implement. So I started to think about using the Regex crate. So this will be a look at how that went.","inLanguage":"en","wordCount":627,"datePublished":"2021-04-20T21:58:40","dateModified":"2021-04-20T21:58:40","image":"https:\/\/bas-man.github.io\/","keywords":["rust, regex, learning"],"mainEntityOfPage":"https:\/\/bas-man.github.io\/post\/rust\/rust-looking-at-regex\/","publisher":{"@type":"Organization","name":"https:\/\/bas-man.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/bas-man.github.io\/","height":60,"width":60}}}</script><meta property="og:title" content="Looking at Regex in Rust"><meta property="og:description" content="If you have been following this series, you might know that I am playing with SPF records. I have turned my eye to a and mx mechanisms. As I started looking at the a mechanism. I noticed that my current approach using the standard string functions would probably be fairly difficult to implement. So I started to think about using the Regex crate. So this will be a look at how that went."><meta property="og:url" content="https://bas-man.github.io/post/rust/rust-looking-at-regex/"><meta property="og:type" content="website"><meta property="og:site_name" content="Bas-Man's Musings"><meta name=twitter:title content="Looking at Regex in Rust"><meta name=twitter:description content="If you have been following this series, you might know that I am playing with SPF records. I have turned my eye to a and mx mechanisms. As I started looking at the a mechanism. I noticed that my â€¦"><meta name=twitter:card content="summary"><link href=https://bas-man.github.io/images/favicons/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.83.1"><link rel=alternate href=https://bas-man.github.io/index.xml type=application/rss+xml title="Bas-Man's Musings"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://bas-man.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://bas-man.github.io/css/highlight.min.css><link rel=stylesheet href=https://bas-man.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><link href=/css/boxes.css rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-CBZDLNDS8F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-CBZDLNDS8F')</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-166598762-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://bas-man.github.io/>Bas-Man's Musings</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li class=navlinks-container><a class=navlinks-parent>Categories</a><div class=navlinks-children><a href=/series>Series</a>
<a href=/categories>Categories</a>
<a href=/tags>Tags</a></div></li><li class=navlinks-container><a class=navlinks-parent>Projects</a><div class=navlinks-children><a href=/projects/github/>GitHub</a>
<a href=/projects/line-notify-from-email/>Line Notification</a></div></li><li class=navlinks-container><a class=navlinks-parent>Docs</a><div class=navlinks-children><a href=/docs/bind-dns-setup/>Bind DNS Setup</a>
<a href=/docs/gmail-zapier-line-notify/>Gmail & Zapier</a></div></li><li class=navlinks-container><a class=navlinks-parent>References</a><div class=navlinks-children><a href=/cheatsheets/python/>Python</a>
<a href=/cheatsheets/perl/>Perl</a>
<a href=/cheatsheets/rust/>Rust</a>
<a href=/cheatsheets/git/>Git</a>
<a href=/cheatsheets/latex/>LaTeX</a></div></li><li class=navlinks-container><a class=navlinks-parent>Snippets</a><div class=navlinks-children><a href=/cheatsheets/python/snippets/>Python</a>
<a href=/cheatsheets/perl/snippets/>Perl</a>
<a href=/cheatsheets/rust/snippets/>Rust</a>
<a href=/cheatsheets/git/snippets/>Git</a></div></li><li><a title=About href=/about/>About</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Looking at Regex in Rust</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on April 20, 2021
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;627&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Bas-Man</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>If you have been following this series, you might know that I am playing with SPF records. I have turned my eye to <code>a</code> and <code>mx</code> <strong>mechanism</strong>s. As I started looking at the <code>a</code> mechanism. I noticed that my current approach using the standard string functions would probably be fairly difficult to implement. So I started to think about using the <a href=https://docs.rs/regex/1.4.5/regex/index.html>Regex</a> crate. So this will be a look at how that went. The challenges and the things that I took away from the experience.</p><p>I started out first by checking what were the possible patterns for an <code>a</code> mechanism. So I did some searching and found <a href=https://dmarcian.com/spf-syntax-table/ title="From https://dmarcian.com/spf-syntax-table/">this link.</a></p><p><img src=/images/spf/a-mechanism.png alt="dmarcian.com Image"></p><p>This also listed some examples</p><table><thead><tr><th>type</th><th>Sample</th></tr></thead><tbody><tr><td>a</td><td>v=spf1 a ~all</td></tr><tr><td>a:domain</td><td>v=spf1 a:example.com ~al</td></tr><tr><td>a:hosts</td><td>v=spf1 a:mailers.example.com ~all</td></tr><tr><td>a/prefix</td><td>v=spf1 a/24 a:offsite.example.com/24 ~all</td></tr></tbody></table><h2 id=initial-attempt>Initial attempt</h2><p>So yes. This I suspect would take a lot of work. But I felt pretty confident in my regex skills. Seemed pretty straight forward. So I started off with my trusty <a href=https://regex101.com/r/hhVmq8/1>regex101 - pattern and test data</a> and came up with a nice regex that covers my cases.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>(?P&lt;a_only&gt;^a)|(?:a:)(?P&lt;a_colon&gt;[^\/].+)|(?P&lt;a_slash&gt;a\/\d{1,2})
</code></pre></div><p>capture a_only or capture a_colon or capture a_slash
It looked pretty clean in regex101. But I wanted to check things in rust.
I came a cross <a href=https://rustexp.lpil.uk>Rustexp</a>. I thought nice. I can throw my pattern in here and check if it works. <strong>Spoiler</strong>: it doesn&rsquo;t like <code>alternatives</code>, all those <code>|</code> pipes.</p><p>So I started looking for another way to get things done. I read through some of the regex docs and found <code>RegexSet</code>.</p><p>With a lot of work I finally settled on the following code.</p><script type=application/javascript src=https://gist.github.com/Bas-Man/8a10393bb9d7c40e5413c460485e2075.js></script><p><code>get_match()</code> does the work here.</p><p>What are we doing here?</p><ol><li>Line 10: Create a RegexSet and pass it along with the string to search into <code>get_match()</code></li><li>Lines 30 ~ 33: Within <code>get_match()</code>, we assume there will be no match and so prepare to return a <strong>None</strong> if the check is false.</li><li>Lines 35 ~ 42:<ol><li>We see if there is a pattern match.</li><li>We get the index of the pattern that matched.</li><li>We get the patterns from RegexSet</li><li>We create an actual <code>Regex::new()</code> To this we pass the pattern located the at the index we found previously.</li><li>Then we run the correct pattern on the string.</li></ol></li><li>We loop over the captures to get the capture we are looking for.</li></ol><p>This is not the best solution. There are a few things that probably need to be addressed.</p><p>But I learned how to use RegexSet to some degree.</p><h2 id=discord>Discord</h2><p>I popped onto discord to share my code and my initial regex101 pattern. I wasn&rsquo;t satisfied with my solution and wanted to see if there were some better options.</p><p>The feedback was positive. And I was shown a couple of solutions.
Thanks to <strong>T-Dark the Holy War Starter</strong> for giving his time and ideas.</p><ol><li><a href="https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=0af5220fe7d4ca69dadde481b3aab816">gist:0af5220fe7d4ca69dadde481b3aab816</a></li><li>I was shown an option using my pattern which initially failed to compile. But with some work I got it working. <a href="https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f317eeb698e7d4790c01edf1a1423b7a">gist:f317eeb698e7d4790c01edf1a1423b7a</a>.</li></ol><p>I changed my pattern to the following:<br><code>r"(?P&lt;a_only>a$)|(?:a:)(?P&lt;a_colon>[^/].+)|(?P&lt;a_slash>a/\d{1,2})"</code></p><ol><li>replace <code>^a</code> with <code>a$</code></li><li>remove the usually required escape sequence <code>\</code></li></ol><h2 id=take-aways>Take Aways</h2><ol><li>Rustexp at the time writing is still a bit limited. But may still be of some help.</li><li>The Rust dicord group is a great place to interact with others and ask question to help in the learning process. They have specific groups for learners.</li><li>In rust the <strong>/</strong> is not a special character and does not need to be escaped, particularly if you are doing something like <code>r"...."</code></li><li>The <a href=https://play.rust-lang.org/>rust playground</a> is really useful.</li></ol><h2 id=closing-thoughts>Closing Thoughts</h2><p>Whilst this is not yet fully complete. I wanted to share this now while it is fresh. I will look at updating this post with the final <strong>regex</strong> solution once I have it fully implemented and tested.</p><div class=blog-tags><a href=https://bas-man.github.io//tags/rust/>rust</a>&nbsp;
<a href=https://bas-man.github.io//tags/regex/>regex</a>&nbsp;
<a href=https://bas-man.github.io//tags/learning/>learning</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f&text=Looking%20at%20Regex%20in%20Rust&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f&title=Looking%20at%20Regex%20in%20Rust" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f&title=Looking%20at%20Regex%20in%20Rust" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f&title=Looking%20at%20Regex%20in%20Rust" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fbas-man.github.io%2fpost%2frust%2frust-looking-at-regex%2f&description=Looking%20at%20Regex%20in%20Rust" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/cheatsheets/rust/snippets/trust-dns-resolver-mx/>Using trust-dns-resolver to do mx lookups</a></li><li><a href=/cheatsheets/rust/snippets/trust-dns-resolver-soa/>Using trust-dns-resolver to do soa lookups</a></li><li><a href=/cheatsheets/python/snippets/multiple-group-regex/>Return a dictionary of Regex Matches</a></li><li><a href=/post/rust/published-my-first-crate/>Published My First Crate: decon-spf</a></li><li><a href=/post/rust/library-with-example-program/>Rust: Add an Example Program to your Library Crate</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://bas-man.github.io/post/rust/rust-basic-testing/ data-toggle=tooltip data-placement=top title="Rust Basic Testing">&larr; Previous Post</a></li><li class=next><a href=https://bas-man.github.io/post/rust/rust-looking-at-regex-addendum/ data-toggle=tooltip data-placement=top title="Looking at Regex in Rust (Addendum)">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/Bas-Man title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://dev.to/basman title=Dev><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-dev fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://flipboard.com/@baspann/coding-kq8v8rh8z?from=share%25!%28EXTRA%20string=%29" title=Flipboard><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-flipboard fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Bas-Man
&nbsp;&bull;&nbsp;&copy;
2020 - 2021
&nbsp;&bull;&nbsp;
<a href=https://bas-man.github.io/>Bas-Man's Musings</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.83.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://bas-man.github.io/js/main.js></script><script src=https://bas-man.github.io/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://bas-man.github.io/js/load-photoswipe.js></script><div class=cookie-container><p>By using this site, you agree to our use of cookies.
We use cookies on this website to give you the best experience on our
site. To find out more, read our <a href=/privacy/>privacy</a> policy.</p><button class=cookie-btn>
Okay</button></div><script src=/js/custom.js></script></body></html>