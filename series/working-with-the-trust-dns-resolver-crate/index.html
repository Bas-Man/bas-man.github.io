<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Working with the trust-dns-resolver Crate - Bas-Man's Musings</title><meta name=author content="Bas-Man"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Bas-Man\u0027s Musings","url":"https:\/\/bas-man.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/bas-man.github.io\/"}</script><meta property="og:title" content="Working with the trust-dns-resolver Crate"><meta property="og:url" content="https://bas-man.github.io/series/working-with-the-trust-dns-resolver-crate/"><meta property="og:type" content="website"><meta property="og:site_name" content="Bas-Man's Musings"><meta name=twitter:title content="Working with the trust-dns-resolver Crate"><meta name=twitter:card content="summary"><link href=https://bas-man.github.io/images/favicons/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.82.1"><link rel=alternate href=https://bas-man.github.io/index.xml type=application/rss+xml title="Bas-Man's Musings"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://bas-man.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://bas-man.github.io/css/highlight.min.css><link rel=stylesheet href=https://bas-man.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-166598762-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://bas-man.github.io/>Bas-Man's Musings</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li class=navlinks-container><a class=navlinks-parent>Categories</a><div class=navlinks-children><a href=/series>Series</a>
<a href=/categories>Categories</a>
<a href=/tags>Tags</a></div></li><li class=navlinks-container><a class=navlinks-parent>Projects</a><div class=navlinks-children><a href=/projects/github/>GitHub</a>
<a href=/projects/line-notify-from-email/>Line Notification</a></div></li><li class=navlinks-container><a class=navlinks-parent>Docs</a><div class=navlinks-children><a href=/docs/bind-dns-setup/>Bind DNS Setup</a>
<a href=/docs/gmail-zapier-line-notify/>Gmail & Zapier</a></div></li><li class=navlinks-container><a class=navlinks-parent>References</a><div class=navlinks-children><a href=/cheatsheets/python/>Python</a>
<a href=/cheatsheets/perl/>Perl</a>
<a href=/cheatsheets/rust/>Rust</a>
<a href=/cheatsheets/git/>Git</a></div></li><li class=navlinks-container><a class=navlinks-parent>Snippets</a><div class=navlinks-children><a href=/cheatsheets/python/snippets/>Python</a>
<a href=/cheatsheets/perl/snippets/>Perl</a>
<a href=/cheatsheets/rust/snippets/>Rust</a>
<a href=/cheatsheets/git/snippets/>Git</a></div></li><li><a title=About href=/about/>About</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=series-heading><h1>Working with the trust-dns-resolver Crate</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-list><article class=post-preview><a href=https://bas-man.github.io/post/rust-trust-dns-resolver-txt-lookup/><h2 class=post-title>TXT lookup using the trust-dns-resolver Crate</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on March 29, 2021
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;280&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Bas-Man</span></p><div class=post-entry><p>This is the third article on using the <strong>trust-dns-resolver</strong> crate<br><strong>Warning: This code is not intended to be used in production. You should review and adjust to your own needs.</strong></p><h2 id=getting-started>Getting Started</h2><p>First we will need to create our development environment.</p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>cargo new trust-dns-resolver <span class=o>&amp;&amp;</span> <span class=nb>cd</span> <span class=nv>$_</span>
</code></pre></div><p>This will give us our standard rust directly structure. We need to add our crate to the <code>Cargo.toml</code></p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>-snip-
<span class=o>[</span>dependencies<span class=o>]</span>
trust-dns-resolver <span class=o>=</span> <span class=s2>&#34;0.20.1&#34;</span>
</code></pre></div><p>Next edit the <code>src/main.rs</code> as follows.</p><script type=application/javascript src=https://gist.github.com/Bas-Man/eb35052052066903ec9ffe9eac57a55b.js></script><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>cargo run
</code></pre></div><p>This outputs the following</p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>TXT Record 1:
globalsign-smime-dv<span class=o>=</span>CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8<span class=o>=</span>

TXT Record 2:
<span class=nv>v</span><span class=o>=</span>spf1 <span class=nv>redirect</span><span class=o>=</span>_spf.google.com

</code></pre></div><h3 id=explaining-the-code>Explaining the code</h3><p>Documentation for the TXT RData can be found <a href=https://docs.rs/trust-dns-proto/0.20.1/trust_dns_proto/rr/rdata/txt/struct.TXT.html>here</a><br>Let&rsquo;s take a look at what we are doing here.<br>Like the previous examples we create a resolver which will do the work of doing the DNS lookups.<br>Next we use the resolver to call <code>txt_lookup()</code> and store the result into <code>txt_response</code>.</p><p><code>txt_response</code> will contain either a <code>TxtLookup</code> or an <code>Err</code>. For this reason we need to handle these two cases. As before I am passing a reference to the <code>display_txt()</code> function.<br>Within <code>display_txt</code> I use <code>match</code> to handle my two cases.<br>In the case of <code>Err</code>. I do nothing and just report there were no TXT records.<br>In the case of <code>TxtLookup</code>, I will need to do some more processing.
I simply make an <code>iter()</code> out of <code>txt_response</code> and loop over it and call <code>to_string()</code> on each record in the <code>iter()</code>.</p><p>I went down a rabbit hole for a while because I incorrectly thought I had to call <code>txt_data()</code> which returns a <code>Box&lt;[u8]</code>, a smart pointer.</p><p>I hope you find this interesting and useful.</p><p>P.S: I might revisit this when I look at using regular expressions.</p></div><div class=blog-tags><a href=https://bas-man.github.io//tags/rust/>rust</a>&nbsp;
<a href=https://bas-man.github.io//tags/crate/>crate</a>&nbsp;
<a href=https://bas-man.github.io//tags/trust-dns-resolver/>trust-dns-resolver</a>&nbsp;
<a href=https://bas-man.github.io//tags/txt/>txt</a>&nbsp;
<a href=https://bas-man.github.io//tags/dns/>dns</a>&nbsp;</div></article><article class=post-preview><a href=https://bas-man.github.io/post/rust-trust-dns-resolver-soa-lookup/><h2 class=post-title>SOA lookup using the trust-dns-resolver Crate</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on March 26, 2021
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;369&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Bas-Man</span></p><div class=post-entry><p>This is a second article on using the <strong>trust-dns-resolver</strong> crate<br><strong>Warning: This code is not intended to be used in production. You should review and adjust to your own needs.</strong></p><h2 id=getting-started>Getting Started</h2><p>First we will need to create our development environment.</p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>cargo new trust-dns-resolver <span class=o>&amp;&amp;</span> <span class=nb>cd</span> <span class=nv>$_</span>
</code></pre></div><p>This will give us our standard rust directly structure. We need to add our crate to the <code>Cargo.toml</code></p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>-snip-
<span class=o>[</span>dependencies<span class=o>]</span>
trust-dns-resolver <span class=o>=</span> <span class=s2>&#34;0.20.1&#34;</span>
</code></pre></div><p>Next edit the <code>src/main.rs</code> as follows.</p><script type=application/javascript src=https://gist.github.com/Bas-Man/b869526dc3bf085e7c5de14f3fa57494.js></script><p>Compile and run the code to make sure everything is ok.</p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>cargo run
</code></pre></div><p>This outputs the following</p><div class=highlight><pre class=chroma><code class=language-zsh data-lang=zsh>Admin: dns-admin.google.com.
Admin Email: dns-admin@google.com
Primary: ns1.google.com.
Serial: <span class=m>364996005</span>
</code></pre></div><h3 id=explaining-the-code>Explaining the code</h3><p>Documentation for the SOA RData can be found <a href=https://docs.rs/trust-dns-proto/0.20.1/trust_dns_proto/rr/rdata/soa/struct.SOA.html>here</a><br>Let&rsquo;s take a look at what we are doing here.<br>Like the first example we create a resolver which will do the work of doing the DNS lookups.<br>Next we use the resolver to call <code>soa_lookup()</code> and store the result into <code>soa_response</code><br><code>soa_response</code> will contain either and <code>SoaLookup</code> or an <code>Err</code>. For this reason we need to handle these two cases. I have changed things up a little this time and I am passing a reference to the <code>display_soa()</code> function. So I am allowing <code>display_soa()</code> to borrow the data. In doing this I am saving on memory and I am also promising that I am not going to mutate <code>soa_response</code> within this function. I will cheat a little and <code>clone()</code> some data later.<br>Within <code>display_soa</code> I again use <code>match</code> to handle my two cases.<br>In the case of <code>Err</code>. I do nothing and just report there were no records.<br>In the case of <code>SoaLookup</code>, I will need to do some more processing.</p><ul><li>First lets make an <code>iter()</code> out of <code>soa_response</code> and loop over it.</li><li>In the loop we get the <code>rname()</code> or the administrative contact and the <code>mname()</code> or primary name server for this domain as well as <code>serial()</code> and access to a few more elements.</li></ul><p>Line 26 is just a cobbled together function to redisplay <code>rname()</code> as a more valid email address which is what it really represents. If anyone can point in the direction of a better way to handle this it would greatly appreciated.</p><p>I hope you find this interesting and useful.</p></div><div class=blog-tags><a href=https://bas-man.github.io//tags/rust/>rust</a>&nbsp;
<a href=https://bas-man.github.io//tags/crate/>crate</a>&nbsp;
<a href=https://bas-man.github.io//tags/trust-dns-resolver/>trust-dns-resolver</a>&nbsp;
<a href=https://bas-man.github.io//tags/soa/>soa</a>&nbsp;
<a href=https://bas-man.github.io//tags/dns/>dns</a>&nbsp;</div></article><article class=post-preview><a href=https://bas-man.github.io/post/rust-trust-dns-resolver-mx-and-host-lookup/><h2 class=post-title>MX and Host lookup using the trust-dns-resolver Crate</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on March 25, 2021
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;4&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;720&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Bas-Man</span></p><div class=post-entry>I used to often work with DNS in one of my previous jobs. So I have always had a long running interesting in DNS. Most recently I have been looking into Rust. I wanted to see how easy it might be to use rust to access DNS records, one; because rust is said to be fast, and also because it&rsquo;s a safe programming language.
This will be a brief write up at my attempt to use trust-dns-resolver to do MX record lookups and subsequently host address lookups.
<a href=https://bas-man.github.io/post/rust-trust-dns-resolver-mx-and-host-lookup/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://bas-man.github.io//tags/rust/>rust</a>&nbsp;
<a href=https://bas-man.github.io//tags/crate/>crate</a>&nbsp;
<a href=https://bas-man.github.io//tags/trust-dns-resolver/>trust-dns-resolver</a>&nbsp;
<a href=https://bas-man.github.io//tags/mx/>mx</a>&nbsp;
<a href=https://bas-man.github.io//tags/dns/>dns</a>&nbsp;</div></article></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/Bas-Man title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://dev.to/basman title=Dev><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-dev fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://flipboard.com/@baspann/coding-kq8v8rh8z?from=share%25!%28EXTRA%20string=%29" title=Flipboard><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-flipboard fa-stack-1x fa-inverse"></i></span></a></li><li><a href=/series/working-with-the-trust-dns-resolver-crate/index.xml title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Bas-Man
&nbsp;&bull;&nbsp;&copy;
2020 - 2021
&nbsp;&bull;&nbsp;
<a href=https://bas-man.github.io/>Bas-Man's Musings</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.82.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://bas-man.github.io/js/main.js></script><script src=https://bas-man.github.io/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://bas-man.github.io/js/load-photoswipe.js></script><div class=cookie-container><p>By using this site, you agree to our use of cookies.
We use cookies on this website to give you the best experience on our
site. To find out more, read our <a href=/privacy/>privacy</a> policy.</p><button class=cookie-btn>
Okay</button></div><script src=/js/custom.js></script></body></html>